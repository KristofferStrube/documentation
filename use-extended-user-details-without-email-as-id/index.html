<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,100,700" media="all">
        
        
        
        <link rel="shortcut icon" href="../favicon.ico">
        

	<title>Use Extended User Details without Email as Id - elmah.io Documentation</title>

        <link href="../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">
        <link href="../style.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="https://elmah.io/">elmah.io</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
                <li><a href="https://elmah.io/features/" id="NavFeatures">Features</a></li>
                <li><a href="https://elmah.io/about/" id="NavAbout">About</a></li>
                <li><a href="https://elmah.io/pricing/" id="NavPricing">Pricing</a></li>
                <li><a href="http://docs.elmah.io/" id="NavDocs">Docs</a></li>
                <li><a href="http://blog.elmah.io/" id="NavBlog">Blog</a></li>
            </ul>

        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix" role="complementary">
	
		<h4 href="#" >Start</h4>
		<ul class="nav bs-sidenav">
		
			<li >
				<a href="..">Welcome</a>
			</li>
		
		</ul>
	
		<h4 href="#" >Installation</h4>
		<ul class="nav bs-sidenav">
		
			<li >
				<a href="../logging-to-elmah-io-from-elmah/">Logging from ELMAH</a>
			</li>
		
			<li >
				<a href="../logging-to-elmah-io-from-web-api/">Logging from Web API</a>
			</li>
		
			<li >
				<a href="../logging-to-elmah-io-from-serilog/">Logging from Serilog</a>
			</li>
		
			<li >
				<a href="../logging-to-elmah-io-from-log4net/">Logging from log4net</a>
			</li>
		
			<li >
				<a href="../logging-to-elmah-io-from-nlog/">Logging from NLog</a>
			</li>
		
			<li >
				<a href="../logging-to-elmah-io-from-nancy/">Logging from Nancy</a>
			</li>
		
			<li >
				<a href="../logging-to-elmah-io-from-servicestack/">Logging from ServiceStack</a>
			</li>
		
			<li >
				<a href="../logging-to-elmah-io-from-blogengine-net/">Logging from BlogEngine.NET</a>
			</li>
		
			<li >
				<a href="../logging-to-elmah-io-from-jsnlog/">Logging from JSNLog</a>
			</li>
		
			<li >
				<a href="../configure-elmah-io-from-code/">Configure elmah.io from code</a>
			</li>
		
		</ul>
	
		<h4 href="#" >Integrations</h4>
		<ul class="nav bs-sidenav">
		
			<li >
				<a href="../integrate-elmah-io-with-slack/">Slack</a>
			</li>
		
			<li >
				<a href="../integrate-elmah-io-with-hipchat/">HipChat</a>
			</li>
		
			<li >
				<a href="../integrate-elmah-io-with-zapier/">Zapier</a>
			</li>
		
		</ul>
	
		<h4 href="#" >Help</h4>
		<ul class="nav bs-sidenav">
		
			<li >
				<a href="../logging-custom-data/">Logging custom data</a>
			</li>
		
			<li >
				<a href="../logging-errors-programmatically/">Logging errors programmatically</a>
			</li>
		
			<li >
				<a href="../logging-through-a-http-proxy/">Logging through a HTTP proxy</a>
			</li>
		
			<li >
				<a href="../logging-to-multiple-elmah-logs/">Logging to multiple logs</a>
			</li>
		
			<li >
				<a href="../remove-sensitive-form-data/">Remove sensitive form data</a>
			</li>
		
			<li class="active">
				<a href="./">Use Extended User Details without Email as Id</a>
			</li>
		
			<li >
				<a href="../use-multiple-logs-for-different-environments/">Use multiple logs for different environments</a>
			</li>
		
		</ul>
	
</div></div>
            <div class="col-md-9" role="main">

<h1 id="use-extended-user-details">Use Extended User Details</h1>
<h2 id="without-email-as-id">without Email as Id</h2>
<p>As you may know, ELMAH automatically logs the user identity as part of the error. To make that happen, ELMAH uses the identity object on the current thread, which gets set by most authentication frameworks for .NET (like ASP.NET Membership Provider and ASP.NET Identity). Some of you may use the users email as key while others use something like a database identifier. If you are using an email, you are already covered and able to see Extended User Details. If not, you need to provide elmah.io with a little help.</p>
<p>In order to tell elmah.io about the users email and still keeping the identifier in the user field, you can enrich the message with a piece of custom data, before sending it off to elmah.io. In order to fully understand the code below, you need to know a bit about <code>ILogger</code>. <code>ILogger</code> is part of the raw <a href="http://www.nuget.org/packages/elmah.io.client">elmah.io client</a>, able to communicate with the <a href="https://elmah.io/api">elmah.io API</a>. <code>ILogger</code> isn’t dependent of ELMAH and it pretty much corresponds to other logging clients known from log4net, nlog etc.</p>
<pre><code class="csharp">Elmah.ErrorLog.GetDefault(null); // Forces creation of logger client
var logger = ErrorLog.Client;
logger.OnMessage += (sender, args) =&gt;
{
    if (string.IsNullOrWhiteSpace(args.Message.User)) return;
    var db = ...;
    var user = db.GetById&lt;User&gt;(args.Message.User);
    args.Message.Data.Add(new Item {Key = &quot;X-ELMAHIO-USEREMAIL&quot;, Value = user.Email});
}
</code></pre>

<p>The first line forces creation of the client. The elmah.io <code>ErrorLog</code> implementation uses a singleton <code>ILogger</code> to communicate with elmah.io.</p>
<p>We then register a new event handler on the <code>OnMessage</code> event. <code>OnMessage</code> event handlers are executed just before a message is send to elmah.io. In the body of the event handler, the users email is fetched from the database by calling the <code>GetById</code> method. How you will be able to convert the user ID to an email depends on your tech stack, but you get the picture.</p>
<p>In the last line the data collection of the message is enriched with a new key value pair. <code>X-ELMAHIO-USEREMAIL</code> tells elmah.io, that the value of that item contains the email of the user involved in the currently logged message.</p>
<p>That’s it! 9 lines of code and you are able to watch every little details about the users experiencing problems on your website:</p>
<p><img alt="Extended User Details" src="../images/extended_user_details.png" /></p></div>
        </div>

    <footer class="col-md-12">
        
    </footer>


        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
    </body>
</html>